<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T√¨nh Y√™u Chu·ªói C·ªßa Ch√∫ng Ta</title>
    <style>
        /* --- CSS STYLES --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #fce4ec 0%, #ffcdd2 100%); /* H·ªìng nh·∫°t ƒë·∫øn h·ªìng ƒë√†o */
            margin: 0;
            flex-direction: column;
            overflow: hidden;
            color: #424242;
        }
        .container {
            background-color: white;
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            text-align: center;
            width: 90%;
            max-width: 400px;
            transition: all 0.7s ease-in-out;
            box-sizing: border-box;
            position: relative;
        }
        .container.hidden {
            opacity: 0;
            transform: translateY(-30px) scale(0.95);
            pointer-events: none;
            position: absolute;
        }
        h1 {
            color: #c2185b;
            margin-bottom: 20px;
            margin-top: 30px;
            font-size: 2.8em;
            letter-spacing: 1.5px;
            font-family: 'Dancing Script', cursive;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.1);
        }
        .account-selection {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 30px;
        }
        .account-button {
            background-color: #ff6f91;
            color: white;
            padding: 18px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 5px 15px rgba(255, 111, 145, 0.4);
            letter-spacing: 0.5px;
        }
        .account-button:hover {
            background-color: #e63968;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(230, 57, 104, 0.5);
        }
        .account-button:active {
            transform: scale(0.97);
            box-shadow: 0 2px 8px rgba(230, 57, 104, 0.3);
        }
        .message {
            margin-top: 25px;
            font-weight: bold;
            font-size: 1.1em;
            display: none;
            animation: fadeIn 0.5s ease-out;
        }
        .message.success {
            color: #4caf50;
        }
        .message.error {
            color: #f44336;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Giao di·ªán sau khi ƒëƒÉng nh·∫≠p (Dashboard) */
        .dashboard-container {
            background-color: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            text-align: center;
            width: 90%;
            max-width: 450px;
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0;
            transform: scale(0.9);
            transition: all 0.6s ease-in-out;
            box-sizing: border-box;
            position: relative;
        }
        .heart-area {
            position: relative;
            display: inline-block;
            cursor: pointer;
            margin-bottom: 25px;
        }
        .heart {
            font-size: 100px;
            color: #e91e63;
            animation: pulse 1.8s infinite alternate ease-in-out;
            text-shadow: 0 0 12px rgba(233, 30, 99, 0.4);
            transition: transform 0.1s ease-out;
        }
        .heart:active {
            transform: scale(0.9);
        }

        /* Hi·ªáu ·ª©ng tr√°i tim bay l√™n */
        .floating-heart {
            position: absolute;
            font-size: 18px;
            color: #ff4081;
            opacity: 0;
            animation: floatUp 2s forwards ease-out;
            pointer-events: none;
        }
        @keyframes floatUp {
            0% {
                transform: translate(0, 0) scale(0.5);
                opacity: 0.8;
            }
            100% {
                transform: translate(calc(var(--x) * 1px), calc(var(--y) * 1px)) scale(1.5);
                opacity: 0;
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }
        .chain-info {
            font-size: 2em;
            font-weight: bold;
            color: #d81b60;
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
        }
        .chain-info span {
            font-size: 1.1em;
            color: #e91e63;
        }
        .dashboard-text {
            font-size: 1em;
            color: #616161;
            margin-bottom: 25px;
        }

        /* Ph·∫ßn hi·ªÉn th·ªã t√™n ng∆∞·ªùi d√πng (ƒë√£ b·ªè ·∫£nh) */
        .users-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            /* ƒê·∫©y kh·ªëi t√™n xu·ªëng d∆∞·ªõi n√∫t ƒêƒÉng xu·∫•t */
            margin-top: 60px; /* ƒêi·ªÅu ch·ªânh gi√° tr·ªã n√†y n·∫øu c·∫ßn */
        }
        .user-profile {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 120px; /* Gi·ªõi h·∫°n chi·ªÅu r·ªông cho m·ªói profile ƒë·ªÉ tr√°nh tr√†n */
            /* V·∫´n gi·ªØ z-index ƒë·ªÉ t√™n hi·ªÉn th·ªã tr√™n c√°c y·∫øu t·ªë kh√°c n·∫øu c√≥ ch·ªìng ch√©o nh·ªè */
            position: relative; 
            z-index: 1; 
        }
        .user-profile .username {
            font-weight: bold;
            color: #e91e63;
            font-size: 1.5em;
            font-family: 'Dancing Script', cursive;
            text-shadow: 1px 1px 3px rgba(255, 128, 171, 0.5);
            white-space: nowrap; /* NgƒÉn t√™n xu·ªëng d√≤ng */
            overflow: hidden; /* ·∫®n ph·∫ßn t√™n tr√†n */
            text-overflow: ellipsis; /* Hi·ªÉn th·ªã "..." n·∫øu t√™n b·ªã tr√†n */
            max-width: 100%; /* ƒê·∫£m b·∫£o t√™n kh√¥ng v∆∞·ª£t qu√° chi·ªÅu r·ªông c·ªßa user-profile */
            transition: color 0.3s ease;
        }
        .user-profile .username:hover {
            color: #d81b60;
        }
        .love-icon {
            font-size: 2.5em;
            color: #ff4081;
            margin: 0 10px;
            animation: pulse 1.5s infinite alternate ease-in-out;
        }

        /* N√∫t th√¥ng b√°o "Nh·ªõ b·∫°n" */
        .remember-button {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background-color: #ff5722;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.2em;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(255, 87, 34, 0.4);
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
            z-index: 999;
        }
        .remember-button:hover {
            background-color: #e64a19;
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 15px rgba(255, 87, 34, 0.5);
        }
        .remember-button:active {
            transform: scale(0.95);
        }

        /* N√∫t ƒêƒÉng xu·∫•t */
        .logout-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: #9e9e9e;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            font-size: 0.9em;
            cursor: pointer;
            transition: background-color 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 10; /* ƒê·∫£m b·∫£o n√∫t n√†y hi·ªÉn th·ªã tr√™n c√πng */
        }
        .logout-button:hover {
            background-color: #757575;
        }

        /* N√∫t Debug/Test */
        .debug-button {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8em;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(33, 150, 243, 0.4);
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
            z-index: 1000;
            font-family: monospace;
        }
        .debug-button.active {
            background-color: #FFC107;
            color: #333;
        }
        .debug-button:hover {
            background-color: #1976D2;
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 15px rgba(33, 150, 243, 0.5);
        }
        .debug-button.active:hover {
            background-color: #FFA000;
        }
        .debug-button:active {
            transform: scale(0.9);
        }
        .debug-button-text {
            font-size: 0.7em;
            position: absolute;
            bottom: 5px;
            pointer-events: none;
        }

        /* N√∫t Admin nh·ªè */
        .admin-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background-color: #673AB7;
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 3px 8px rgba(103, 58, 183, 0.4);
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
            z-index: 1000;
        }
        .admin-button:hover {
            background-color: #512DA8;
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 10px rgba(103, 58, 183, 0.5);
        }
        .admin-button:active {
            transform: scale(0.9);
        }
        
        /* Modal (H·ªôp tho·∫°i chung) */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 400px;
            text-align: center;
            animation: slideIn 0.3s ease-out;
            position: relative;
        }
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-content h2 {
            color: #673AB7;
            margin-bottom: 20px;
            font-size: 1.6em;
        }
        .modal-content input[type="password"],
        .modal-content input[type="number"],
        .modal-content input[type="text"], /* Th√™m cho ƒë·ªïi t√™n */
        .modal-content select, /* Th√™m cho ch·ªçn gi·ªõi t√≠nh */
        .modal-content input[type="color"] { /* Th√™m cho input color */
            width: calc(100% - 20px);
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1.1em;
            box-sizing: border-box;
            -webkit-appearance: none; /* Lo·∫°i b·ªè style m·∫∑c ƒë·ªãnh c·ªßa tr√¨nh duy·ªát cho input color */
            -moz-appearance: none;
            appearance: none;
            cursor: pointer;
            height: 48px; /* ƒê·∫£m b·∫£o chi·ªÅu cao t∆∞∆°ng t·ª± c√°c input kh√°c */
        }
        .modal-content input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        .modal-content input[type="color"]::-webkit-color-swatch {
            border: none;
            border-radius: 6px;
        }
        .modal-content button {
            background-color: #673AB7;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin: 5px;
        }
        .modal-content button:hover {
            background-color: #512DA8;
            transform: translateY(-1px);
        }
        .modal-content .close-button {
            position: absolute;
            top: 15px;
            right: 20px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .modal-content .close-button:hover,
        .modal-content .close-button:focus {
            color: #333;
            text-decoration: none;
        }
        .modal-message {
            margin-top: 15px;
            font-weight: bold;
            color: #f44336;
            display: none;
        }
        .modal-message.success {
            color: #4caf50;
        }

        /* D√†nh cho ch·∫ø ƒë·ªô Admin (hi·ªÉn th·ªã khi admin ƒëƒÉng nh·∫≠p) */
        .admin-controls {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            display: flex;
            flex-direction: column;
            gap: 15px;
            text-align: left;
        }
        .admin-controls h2 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #424242; /* Thay ƒë·ªïi m√†u s·∫Øc ƒë·ªÉ d·ªÖ nh√¨n h∆°n */
            font-size: 1.4em; /* K√≠ch th∆∞·ªõc nh·ªè h∆°n m·ªôt ch√∫t */
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }
        .admin-controls label {
            font-weight: bold;
            color: #673AB7;
            font-size: 1.1em;
            margin-bottom: 5px;
            display: block; /* ƒê·∫£m b·∫£o label ƒë·ª©ng tr√™n input */
        }
        .admin-controls .input-group { /* Nh√≥m input v√† label */
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 10px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }
        .admin-controls select,
        .admin-controls input[type="text"],
        .admin-controls input[type="number"] {
            width: calc(100% - 20px); /* Adjust width for padding */
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 1em;
            margin-top: 5px;
            box-sizing: border-box;
        }
        .admin-controls .action-buttons {
            display: flex;
            justify-content: space-around;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .admin-controls .action-buttons button {
            flex-grow: 1;
            min-width: 120px;
        }

        /* Styles cho d√≤ng ch·ªØ "K·∫øt n·ªëi t√¨nh y√™u" */
        .love-connection-text {
            margin-top: 25px;
            font-family: 'Dancing Script', cursive;
            font-size: 2.5em;
            color: #d81b60;
            text-shadow: 3px 3px 8px rgba(255, 128, 171, 0.6);
            letter-spacing: 2px;
            animation: fadeInScale 2s ease-out forwards;
            /* **QUAN TR·ªåNG**: Ch·ªâ hi·ªÉn th·ªã ·ªü m√†n h√¨nh ƒëƒÉng nh·∫≠p */
            display: block; /* M·∫∑c ƒë·ªãnh l√† block ƒë·ªÉ hi·ªÉn th·ªã ·ªü login */
        }

        /* ·∫®n d√≤ng ch·ªØ "K·∫øt n·ªëi t√¨nh y√™u" khi dashboard hi·ªÉn th·ªã */
        body.dashboard-active .love-connection-text {
            display: none;
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        /* --- Styles cho Love Notification Modal (B·∫£ng t√¨nh y√™u - th√¥ng b√°o Nh·ªõ b·∫°n) --- */
        #loveNotificationModal .modal-content {
            background: linear-gradient(160deg, #ffe0b2 0%, #ffcc80 100%); /* N·ªÅn cam ƒë√†o nh·∫π */
            padding: 35px;
            border-radius: 20px;
            border: 3px solid #ff9800; /* Vi·ªÅn cam n·ªïi b·∫≠t */
            box-shadow: 0 10px 30px rgba(255, 152, 0, 0.4); /* ƒê·ªï b√≥ng cam */
            max-width: 380px;
            animation: bounceIn 0.6s ease-out; /* Hi·ªáu ·ª©ng n·∫£y v√†o */
        }

        @keyframes bounceIn {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }

        #loveNotificationModal h2 {
            font-family: 'Dancing Script', cursive;
            color: #e65100; /* Cam ƒë·∫≠m */
            font-size: 2.5em;
            margin-bottom: 15px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }

        #loveNotificationModal .love-message-content {
            font-size: 1.3em;
            color: #795548; /* N√¢u ƒë·∫•t nh·∫π nh√†ng */
            line-height: 1.6;
            margin-bottom: 25px;
            font-weight: 500;
        }

        #loveNotificationModal .love-icon-big {
            font-size: 3em;
            color: #f44336; /* ƒê·ªè t∆∞∆°i */
            animation: heartBeat 1.5s infinite alternate; /* Hi·ªáu ·ª©ng ƒë·∫≠p tim */
            margin-bottom: 20px;
        }

        @keyframes heartBeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        #loveNotificationModal button {
            background-color: #ff9800; /* Cam s√°ng */
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 10px rgba(255, 152, 0, 0.3);
        }

        #loveNotificationModal button:hover {
            background-color: #f57c00; /* Cam ƒë·∫≠m h∆°n */
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(245, 124, 0, 0.4);
        }

        #loveNotificationModal .close-button {
            color: #d32f2f; /* ƒê·ªè ƒë·∫≠m cho n√∫t ƒë√≥ng */
            font-size: 30px;
            top: 10px;
            right: 15px;
        }
        #loveNotificationModal .close-button:hover {
            color: #b71c1c;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="login-container" class="container">
        <h1>Ch·ªçn t√†i kho·∫£n c·ªßa b·∫°n</h1>
        <div class="account-selection">
            <button class="account-button" onclick="loginUser('Nhat Quang')">ƒêƒÉng nh·∫≠p v·ªõi Nh·∫≠t Quang</button>
            <button class="account-button" onclick="loginUser('Linh Nhu')">ƒêƒÉng nh·∫≠p v·ªõi Linh Nhu</button>
        </div>
        <p id="login-message" class="message"></p>
    </div>

    <div class="love-connection-text">
        K·∫øt N·ªëi T√¨nh Y√™u üíñ
    </div>

    <div id="dashboard-container" class="dashboard-container">
        <button class="logout-button" onclick="logoutUser()">ƒêƒÉng xu·∫•t</button>

        <div class="users-display">
            <div class="user-profile">
                <div id="current-user-name" class="username"></div>
            </div>
            <span class="love-icon">üíï</span> 
            <div class="user-profile">
                <div id="connected-user-name" class="username"></div>
            </div>
        </div>

        <div class="heart-area" id="heart-click-area">
            <div class="heart">‚ù§Ô∏è</div>
        </div>
        <p class="chain-info">Chu·ªói y√™u th∆∞∆°ng c·ªßa b·∫°n: <span id="love-chain-count">0</span> ng√†y</p>
        <p class="dashboard-text">Gi·ªØ chu·ªói n√†y m·ªói ng√†y ƒë·ªÉ t√¨nh y√™u lu√¥n b·ªÅn ch·∫∑t nh√©!</p>

        <p class="dashboard-text">Hai b·∫°n ƒë√£ ƒë∆∞·ª£c k·∫øt n·ªëi t·ª± ƒë·ªông ƒë·ªÉ c√πng nhau gi·ªØ chu·ªói!</p>

        <button class="remember-button" onclick="sendRememberNotification()">
            üíñ
        </button>
    </div>

    <button class="debug-button" id="debug-toggle-button" onclick="toggleDebugMode()">
        üêõ
        <span class="debug-button-text">Test</span>
    </button>

    <button class="admin-button" onclick="openAdminModal()">
        ‚öôÔ∏è
    </button>

    <div id="adminModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeAdminModal()">&times;</span>
            <h2 id="admin-modal-title">Admin Access</h2>
            <div id="admin-password-section">
                <p>Nh·∫≠p m·∫≠t kh·∫©u Admin:</p>
                <input type="password" id="adminPasswordInput" placeholder="M·∫≠t kh·∫©u">
                <button onclick="checkAdminPassword()">X√°c nh·∫≠n</button>
                <p id="adminPasswordMessage" class="modal-message"></p>
            </div>

            <div id="admin-controls-section" class="admin-controls" style="display: none;">
                <h2>Qu·∫£n l√Ω T√†i kho·∫£n</h2>
                <div class="input-group">
                    <label for="selectUserToEdit">Ch·ªçn ng∆∞·ªùi d√πng:</label>
                    <select id="selectUserToEdit" onchange="displaySelectedUserInfo()"></select>
                </div>
                
                <div class="input-group">
                    <label for="editUserName">S·ª≠a t√™n t√†i kho·∫£n:</label>
                    <input type="text" id="editUserName" placeholder="T√™n m·ªõi">
                    <button onclick="editUserName()">L∆∞u t√™n</button>
                </div>

                <div class="input-group">
                    <label for="editUserGender">S·ª≠a gi·ªõi t√≠nh:</label>
                    <select id="editUserGender">
                        <option value="male">Nam</option>
                        <option value="female">N·ªØ</option>
                        <option value="other">Kh√°c</option>
                    </select>
                    <button onclick="editUserGender()">L∆∞u gi·ªõi t√≠nh</button>
                </div>

                <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">

                <h2>S·ª≠a ƒë·ªïi Chu·ªói Y√™u Th∆∞∆°ng</h2>
                <div class="input-group">
                    <label for="newLoveChainValue">Gi√° tr·ªã chu·ªói m·ªõi:</label>
                    <input type="number" id="newLoveChainValue" min="1">
                </div>
                <div class="action-buttons">
                    <button onclick="setLoveChain()">ƒê·∫∑t chu·ªói</button>
                    <button onclick="increaseLoveChain()">TƒÉng chu·ªói (+1)</button>
                    <button onclick="decreaseLoveChain()">Gi·∫£m chu·ªói (-1)</button>
                    <button onclick="resetLoveChainForUser()">Reset v·ªÅ 1</button>
                </div>
                <p id="adminActionMessage" class="modal-message"></p>

                <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">

                <h2>Ch·ªânh S·ª≠a Giao Di·ªán</h2>
                <div class="input-group">
                    <label for="backgroundColorPicker">M√†u n·ªÅn ch√≠nh (Gradient 1):</label>
                    <input type="color" id="backgroundColorPicker" value="#fce4ec">
                    <label for="backgroundColorPicker2">M√†u n·ªÅn ph·ª• (Gradient 2):</label>
                    <input type="color" id="backgroundColorPicker2" value="#ffcdd2">
                    <button onclick="applyBackgroundColors()">√Åp d·ª•ng m√†u n·ªÅn</button>
                </div>
                <p id="themeMessage" class="modal-message"></p>
                </div>
        </div>
    </div>

    <div id="loveNotificationModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeLoveNotificationModal()">&times;</span>
            <h2>L·ªùi Nh·∫Øn Y√™u Th∆∞∆°ng!</h2>
            <div class="love-icon-big">üíå</div>
            <p id="loveNotificationMessage" class="love-message-content"></p>
            <button onclick="closeLoveNotificationModal()">Tuy·ªát v·ªùi!</button>
        </div>
    </div>

    <div id="heartfeltNotification" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeHeartfeltNotification()">&times;</span>
            <div class="love-icon-big">üíñ</div>
            <h2>L·ªùi Nh·∫Øn Ng·ªçt Ng√†o!</h2>
            <p class="love-message-content">
                C·∫£m ∆°n b·∫°n ƒë√£ trao tr√°i tim!
                <br>
                Gh√© thƒÉm ng√¥i nh√† nh·ªè c·ªßa ch√∫ng m√¨nh t·∫°i <a href="LINK_TO_OTHER_ACCOUNT_HERE" target="_blank" class="account-link">@T√™nAccKia</a> nh√©?
                <br>
                N∆°i ƒë√≥ c√≥ nhi·ªÅu ƒëi·ªÅu th√∫ v·ªã ƒëang ch·ªù ƒë√≥n b·∫°n! üòä
            </p>
            <button onclick="closeHeartfeltNotification()">ƒê√£ hi·ªÉu!</button>
        </div>
    </div>


    <script>
        // --- JAVASCRIPT LOGIC ---
        const loginMessage = document.getElementById('login-message');
        const loginContainer = document.getElementById('login-container');
        const dashboardContainer = document.getElementById('dashboard-container');
        const loveChainCount = document.getElementById('love-chain-count');
        const heartClickArea = document.getElementById('heart-click-area');
        const debugToggleButton = document.getElementById('debug-toggle-button');

        // C√°c element cho t√™n ng∆∞·ªùi d√πng
        const currentUserName = document.getElementById('current-user-name');
        const connectedUserName = document.getElementById('connected-user-name');

        // C√°c element cho Admin Modal
        const adminModal = document.getElementById('adminModal');
        const adminPasswordInput = document.getElementById('adminPasswordInput');
        const adminPasswordMessage = document.getElementById('adminPasswordMessage');
        const adminPasswordSection = document.getElementById('admin-password-section');
        const adminControlsSection = document.getElementById('admin-controls-section');
        const selectUserToEdit = document.getElementById('selectUserToEdit');
        const newLoveChainValueInput = document.getElementById('newLoveChainValue');
        const editUserNameInput = document.getElementById('editUserName'); // Th√™m cho ƒë·ªïi t√™n
        const editUserGenderSelect = document.getElementById('editUserGender'); // Th√™m cho ƒë·ªïi gi·ªõi t√≠nh
        const adminActionMessage = document.getElementById('adminActionMessage');

        // C√°c element cho Love Notification Modal m·ªõi (l·ªùi nh·∫Øn y√™u th∆∞∆°ng)
        const loveNotificationModal = document.getElementById('loveNotificationModal');
        const loveNotificationMessage = document.getElementById('loveNotificationMessage');

        // C√°c element cho heartfeltNotification (nh·ªõ b·∫°n)
        const heartfeltNotification = document.getElementById('heartfeltNotification');


        // C√°c element cho ch·ªânh s·ª≠a giao di·ªán
        const backgroundColorPicker = document.getElementById('backgroundColorPicker');
        const backgroundColorPicker2 = document.getElementById('backgroundColorPicker2');
        const themeMessage = document.getElementById('themeMessage');


        // M·∫≠t kh·∫©u Admin (c√≥ th·ªÉ thay ƒë·ªïi)
        const ADMIN_PASSWORD = 'admin'; // B·∫°n c√≥ th·ªÉ thay ƒë·ªïi m·∫≠t kh·∫©u n√†y

        // B·∫≠t/t·∫Øt ch·∫ø ƒë·ªô debug (test)
        let isDebugMode = localStorage.getItem('isDebugMode') === 'true'; // L∆∞u tr·∫°ng th√°i debug
        let isAdminLoggedIn = false; // Tr·∫°ng th√°i ƒëƒÉng nh·∫≠p Admin

        // H√†m l·∫•y d·ªØ li·ªáu ng∆∞·ªùi d√πng t·ª´ localStorage ho·∫∑c kh·ªüi t·∫°o m·∫∑c ƒë·ªãnh
        function loadUsersData() {
            const storedData = localStorage.getItem('loveChainUsers');
            if (storedData) {
                const parsedData = JSON.parse(storedData);
                // ƒê·∫£m b·∫£o t·∫•t c·∫£ ng∆∞·ªùi d√πng ƒë·ªÅu c√≥ tr∆∞·ªùng 'gender' v√† 'username' (t√™n ban ƒë·∫ßu)
                for (const userKey in parsedData) {
                    if (!parsedData[userKey].gender) {
                        parsedData[userKey].gender = 'other'; // M·∫∑c ƒë·ªãnh l√† 'other' n·∫øu ch∆∞a c√≥
                    }
                    if (!parsedData[userKey].username) {
                        // N·∫øu ch∆∞a c√≥ username, ƒë·∫∑t m·∫∑c ƒë·ªãnh l√† key
                        parsedData[userKey].username = userKey;
                    }
                }
                return parsedData;
            }
            // D·ªØ li·ªáu m·∫∑c ƒë·ªãnh n·∫øu ch∆∞a c√≥ trong localStorage
            return {
                'Nhat Quang': {
                    loveChain: 1,
                    lastClickedDate: '',
                    connectedUser: 'Linh Nhu',
                    hasClickedToday: false,
                    gender: 'male',
                    username: 'Nh·∫≠t Quang' // T√™n g·ªëc c·ªßa t√†i kho·∫£n
                },
                'Linh Nhu': {
                    loveChain: 1,
                    lastClickedDate: '',
                    connectedUser: 'Nhat Quang',
                    hasClickedToday: false,
                    gender: 'female',
                    username: 'Linh Nhu' // T√™n g·ªëc c·ªßa t√†i kho·∫£n
                }
            };
        }

        // H√†m l∆∞u d·ªØ li·ªáu ng∆∞·ªùi d√πng v√†o localStorage
        function saveUsersData(dataToSave = users) {
            localStorage.setItem('loveChainUsers', JSON.stringify(dataToSave));
        }

        // H√†m l∆∞u th√¥ng b√°o ch·ªù v√†o localStorage
        function savePendingNotification(targetUsernameKey, message) {
            const key = `pendingNotification_${targetUsernameKey}`;
            localStorage.setItem(key, message);
        }

        // H√†m l·∫•y v√† x√≥a th√¥ng b√°o ch·ªù
        function getAndClearPendingNotification(targetUsernameKey) {
            const key = `pendingNotification_${targetUsernameKey}`;
            const message = localStorage.getItem(key);
            if (message) {
                localStorage.removeItem(key); // X√≥a ngay sau khi ƒë·ªçc
            }
            return message;
        }

        let users = loadUsersData(); // T·∫£i d·ªØ li·ªáu khi kh·ªüi ƒë·ªông
        let currentUser = null; // L∆∞u tr·ªØ ng∆∞·ªùi d√πng ƒëang ƒëƒÉng nh·∫≠p (t√™n kh√≥a, v√≠ d·ª• 'Nhat Quang')

        // Bi·∫øn ƒë·ªÉ l∆∞u tr·ªØ chu·ªói "th·∫≠t" khi b·∫≠t ch·∫ø ƒë·ªô test
        let realLoveChainData = null;

        // H√†m l·∫•y ng√†y hi·ªán t·∫°i ·ªü ƒë·ªãnh d·∫°ng YYYY-MM-DD
        function getTodayDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // H√†m c·∫≠p nh·∫≠t hi·ªÉn th·ªã t√™n
        function updateNames() {
            if (currentUser && users[currentUser]) {
                const user = users[currentUser];
                currentUserName.textContent = user.username; // Hi·ªÉn th·ªã t√™n ƒë√£ s·ª≠a ƒë·ªïi
                if (user.connectedUser && users[user.connectedUser]) {
                    connectedUserName.textContent = users[user.connectedUser].username; // Hi·ªÉn th·ªã t√™n ƒë√£ s·ª≠a ƒë·ªïi c·ªßa ng∆∞·ªùi kia
                } else {
                    connectedUserName.textContent = 'Ng∆∞·ªùi y√™u'; // Fallback n·∫øu kh√¥ng c√≥ ng∆∞·ªùi k·∫øt n·ªëi
                }
            }
        }

        // H√†m ƒëƒÉng nh·∫≠p tr·ª±c ti·∫øp khi nh·∫•n n√∫t
        function loginUser(usernameKey) { // Gi·ªù nh·∫≠n v√†o key (Nhat Quang/Linh Nhu)
            currentUser = usernameKey;
            localStorage.setItem('lastLoggedInUser', currentUser); // L∆∞u ng∆∞·ªùi d√πng cu·ªëi c√πng ƒëƒÉng nh·∫≠p

            // Lu√¥n t·∫£i d·ªØ li·ªáu m·ªõi nh·∫•t t·ª´ localStorage khi ƒëƒÉng nh·∫≠p
            users = loadUsersData();
            const user = users[currentUser];

            // C·∫≠p nh·∫≠t tr·∫°ng th√°i hasClickedToday d·ª±a tr√™n lastClickedDate ƒë√£ l∆∞u
            // B·ªè qua ki·ªÉm tra ng√†y n·∫øu ƒëang ·ªü ch·∫ø ƒë·ªô debug
            user.hasClickedToday = isDebugMode ? false : (user.lastClickedDate === getTodayDate());
            saveUsersData(); // L∆∞u l·∫°i ngay ƒë·ªÉ ƒë·∫£m b·∫£o tr·∫°ng th√°i ƒë√£ c·∫≠p nh·∫≠t

            loginMessage.textContent = `ƒêƒÉng nh·∫≠p th√†nh c√¥ng! Ch√†o m·ª´ng ${user.username}!`; // Hi·ªÉn th·ªã t√™n ƒë√£ s·ª≠a ƒë·ªïi
            loginMessage.className = 'message success';
            loginMessage.style.display = 'block';

            setTimeout(() => {
                loginContainer.classList.add('hidden');
                dashboardContainer.style.opacity = '1';
                dashboardContainer.style.transform = 'scale(1)';
                document.body.classList.add('dashboard-active'); // Th√™m class ƒë·ªÉ ·∫©n "K·∫øt n·ªëi t√¨nh y√™u"

                updateDashboard();
                checkAndShowPendingNotification(); // K√≠ch ho·∫°t ki·ªÉm tra v√† hi·ªÉn th·ªã th√¥ng b√°o ch·ªù
            }, 800);
        }

        // H√†m ƒëƒÉng xu·∫•t
        function logoutUser() {
            currentUser = null;
            localStorage.removeItem('lastLoggedInUser');
            dashboardContainer.style.opacity = '0';
            dashboardContainer.style.transform = 'scale(0.9)';
            document.body.classList.remove('dashboard-active'); // X√≥a class ƒë·ªÉ hi·ªÉn th·ªã "K·∫øt n·ªëi t√¨nh y√™u"
            setTimeout(() => {
                loginContainer.classList.remove('hidden');
                loginMessage.style.display = 'none'; // ·∫®n th√¥ng b√°o ƒëƒÉng nh·∫≠p
                if (adminModal.style.display === 'flex') { // ƒê√≥ng admin modal n·∫øu ƒëang m·ªü
                    closeAdminModal();
                }
            }, 600);
        }

        // H√†m c·∫≠p nh·∫≠t Dashboard
        function updateDashboard() {
            if (currentUser && users[currentUser]) {
                const user = users[currentUser];
                const connectedUser = users[user.connectedUser];

                updateNames(); // C·∫≠p nh·∫≠t t√™n hi·ªÉn th·ªã
                loveChainCount.textContent = user.loveChain;

                // Thay ƒë·ªïi m√†u tr√°i tim d·ª±a tr√™n tr·∫°ng th√°i click
                const heartElement = heartClickArea.querySelector('.heart');
                if (user.hasClickedToday) {
                    heartElement.style.color = '#ccc'; // M√†u x√°m n·∫øu ƒë√£ click
                    heartElement.style.animation = 'none'; // D·ª´ng animation
                } else {
                    heartElement.style.color = '#e91e63'; // M√†u h·ªìng n·∫øu ch∆∞a click
                    heartElement.style.animation = 'pulse 1.8s infinite alternate ease-in-out'; // Ch·∫°y animation
                }
            }
        }

        // --- Heart Click Logic ---
        heartClickArea.addEventListener('click', function(event) {
            if (!currentUser) return; // ƒê·∫£m b·∫£o ƒë√£ ƒëƒÉng nh·∫≠p

            const user = users[currentUser];
            const today = getTodayDate();

            // N·∫øu ƒëang ·ªü ch·∫ø ƒë·ªô debug, lu√¥n cho ph√©p click v√† hi·ªÉn th·ªã pop-up ƒë·∫∑c bi·ªát
            if (isDebugMode) {
                user.loveChain++;
                loveChainCount.textContent = user.loveChain;
                showLoveNotification(`üéâ B·∫°n ƒë√£ click th√™m m·ªôt tr√°i tim (Ch·∫ø ƒë·ªô Debug)! Chu·ªói y√™u th∆∞∆°ng: ${user.loveChain} ng√†y.`, 'success');
                saveUsersData(); // L∆∞u l·∫°i ngay c·∫£ trong debug
                return; // K·∫øt th√∫c h√†m n·∫øu ƒëang debug
            }
            
            // Logic cho ch·∫ø ƒë·ªô b√¨nh th∆∞·ªùng
            if (!user.hasClickedToday) {
                // N·∫øu ch∆∞a click h√¥m nay
                if (user.lastClickedDate === today) {
                    // Tr∆∞·ªùng h·ª£p n√†y kh√¥ng n√™n x·∫£y ra n·∫øu logic hasClickedToday ƒë√∫ng, nh∆∞ng ƒë·ªÉ an to√†n
                    showLoveNotification('B·∫°n ƒë√£ click tr√°i tim h√¥m nay r·ªìi nh√©! H√£y ƒë·ª£i ƒë·∫øn ng√†y mai.', 'error');
                } else if (user.lastClickedDate === '' || user.lastClickedDate === getPreviousDate(today)) {
                    // N·∫øu l√† ng√†y ƒë·∫ßu ti√™n click ho·∫∑c click v√†o ng√†y k·∫ø ti·∫øp c·ªßa chu·ªói c≈©
                    user.loveChain++;
                    showLoveNotification(`üíñ Chu·ªói y√™u th∆∞∆°ng c·ªßa b·∫°n ƒë√£ tƒÉng l√™n ${user.loveChain} ng√†y! C·ªë g·∫Øng duy tr√¨ nh√©!`, 'success');
                } else {
                    // Chu·ªói b·ªã ƒë·ª©t, reset v·ªÅ 1
                    user.loveChain = 1;
                    showLoveNotification('üíî Chu·ªói y√™u th∆∞∆°ng c·ªßa b·∫°n ƒë√£ b·ªã ƒë·ª©t! B·∫Øt ƒë·∫ßu l·∫°i t·ª´ 1 nh√©.', 'error');
                }
                user.lastClickedDate = today;
                user.hasClickedToday = true; // ƒê√°nh d·∫•u ƒë√£ click h√¥m nay

                // TƒÉng chu·ªói c·ªßa ng∆∞·ªùi ƒë∆∞·ª£c k·∫øt n·ªëi
                const connectedUserKey = user.connectedUser;
                if (connectedUserKey && users[connectedUserKey]) {
                    const connectedUser = users[connectedUserKey];
                    // N·∫øu ng∆∞·ªùi k·∫øt n·ªëi ch∆∞a click h√¥m nay v√† kh√¥ng ph·∫£i l√† ng√†y reset chu·ªói
                    if (!connectedUser.hasClickedToday) {
                        connectedUser.loveChain++;
                        connectedUser.lastClickedDate = today;
                        connectedUser.hasClickedToday = true;
                        // Kh√¥ng c·∫ßn th√¥ng b√°o cho ng∆∞·ªùi kia ngay, h·ªç s·∫Ω th·∫•y khi ƒëƒÉng nh·∫≠p
                    } else if (connectedUser.lastClickedDate !== today && connectedUser.lastClickedDate !== getPreviousDate(today)) {
                         // N·∫øu ng∆∞·ªùi kia ƒë√£ click nh∆∞ng kh√¥ng ph·∫£i h√¥m nay v√† chu·ªói b·ªã ƒë·ª©t (ch·ªâ ng∆∞·ªùi n√†y click)
                        connectedUser.loveChain = 1;
                        connectedUser.lastClickedDate = today;
                        connectedUser.hasClickedToday = true;
                    }
                }
                saveUsersData(); // L∆∞u d·ªØ li·ªáu sau khi c·∫≠p nh·∫≠t
                updateDashboard(); // C·∫≠p nh·∫≠t giao di·ªán
                createFloatingHeart(event); // T·∫°o hi·ªáu ·ª©ng tr√°i tim bay l√™n
            } else {
                // N·∫øu ƒë√£ click h√¥m nay
                showLoveNotification('B·∫°n ƒë√£ click tr√°i tim h√¥m nay r·ªìi nh√©! H√£y ƒë·ª£i ƒë·∫øn ng√†y mai.', 'error');
            }
        });

        // H√†m l·∫•y ng√†y tr∆∞·ªõc ƒë√≥ (d√πng ƒë·ªÉ ki·ªÉm tra chu·ªói li√™n t·ª•c)
        function getPreviousDate(dateString) {
            const date = new Date(dateString);
            date.setDate(date.getDate() - 1);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // T·∫°o hi·ªáu ·ª©ng tr√°i tim bay l√™n
        function createFloatingHeart(event) {
            const heart = document.createElement('span');
            heart.classList.add('floating-heart');
            heart.textContent = '‚ù§Ô∏è';
            document.body.appendChild(heart);

            const rect = heartClickArea.getBoundingClientRect();
            const x = event.clientX - rect.left - (heart.offsetWidth / 2);
            const y = event.clientY - rect.top - (heart.offsetHeight / 2);

            heart.style.left = `${rect.left + rect.width / 2}px`;
            heart.style.top = `${rect.top + rect.height / 2}px`;

            // Randomize target position for floating hearts
            const targetX = (Math.random() - 0.5) * 100; // -50 to 50
            const targetY = -(50 + Math.random() * 100); // -50 to -150

            heart.style.setProperty('--x', targetX);
            heart.style.setProperty('--y', targetY);

            heart.addEventListener('animationend', () => {
                heart.remove();
            });
        }


        // --- Love Notification Modal (Hi·ªÉn th·ªã th√¥ng b√°o chung) ---
        function showLoveNotification(message, type) {
            loveNotificationMessage.textContent = message;
            loveNotificationMessage.className = `love-message-content ${type}`; // Apply success/error class
            loveNotificationModal.style.display = 'flex';
        }

        function closeLoveNotificationModal() {
            loveNotificationModal.style.display = 'none';
        }

        // --- Heartfelt Notification Modal (Th√¥ng b√°o Nh·ªõ b·∫°n) ---
        function showHeartfeltNotification(message) {
            // This function is for the *separate* "Nh·ªõ b·∫°n" button notification
            // It uses the same modal ID, but we can differentiate messages
            const notificationMessageElement = heartfeltNotification.querySelector('.love-message-content');
            notificationMessageElement.innerHTML = message; // Use innerHTML to allow for links
            heartfeltNotification.style.display = 'flex';
        }

        function closeHeartfeltNotification() {
            heartfeltNotification.style.display = 'none';
        }

        // H√†m g·ª≠i th√¥ng b√°o "Nh·ªõ b·∫°n" ƒë·∫øn t√†i kho·∫£n kia
        function sendRememberNotification() {
            if (!currentUser) {
                showLoveNotification('B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ g·ª≠i l·ªùi nh·∫Øc!', 'error');
                return;
            }

            const sender = users[currentUser].username;
            const receiverKey = users[currentUser].connectedUser;
            const receiver = users[receiverKey].username;

            if (!receiverKey || !users[receiverKey]) {
                showLoveNotification('Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi ƒë∆∞·ª£c k·∫øt n·ªëi ƒë·ªÉ g·ª≠i l·ªùi nh·∫Øc.', 'error');
                return;
            }

            const message = `üëã ${sender} v·ª´a g·ª≠i l·ªùi nh·∫Øn nh·ªõ b·∫°n! Gh√© thƒÉm ƒë·ªÉ c√πng gi·ªØ chu·ªói y√™u th∆∞∆°ng nh√©! üíñ`;
            savePendingNotification(receiverKey, message);
            
            showLoveNotification(`ƒê√£ g·ª≠i l·ªùi nh·∫Øn nh·ªõ ƒë·∫øn ${receiver}!`, 'success');
        }

        // H√†m ki·ªÉm tra v√† hi·ªÉn th·ªã th√¥ng b√°o ch·ªù khi ng∆∞·ªùi d√πng ƒëƒÉng nh·∫≠p
        function checkAndShowPendingNotification() {
            if (currentUser) {
                const message = getAndClearPendingNotification(currentUser);
                if (message) {
                    // Display the message using your loveNotificationModal
                    showLoveNotification(message, 'info'); // Using 'info' for a neutral style if you add one, or 'success'
                }
            }
        }


        // --- Admin Modal Logic ---
        function openAdminModal() {
            adminModal.style.display = 'flex';
            if (isAdminLoggedIn) {
                adminPasswordSection.style.display = 'none';
                adminControlsSection.style.display = 'flex';
                adminModal.querySelector('h2').textContent = 'Admin Controls';
                populateUserSelect();
                displaySelectedUserInfo(); // Display info for the first user
                // Load background colors if saved
                const customBg1 = localStorage.getItem('customBgColor1');
                const customBg2 = localStorage.getItem('customBgColor2');
                if (customBg1) backgroundColorPicker.value = customBg1;
                if (customBg2) backgroundColorPicker2.value = customBg2;
            } else {
                adminPasswordSection.style.display = 'block';
                adminControlsSection.style.display = 'none';
                adminModal.querySelector('h2').textContent = 'Admin Access';
                adminPasswordInput.value = '';
                adminPasswordMessage.style.display = 'none';
            }
        }

        function closeAdminModal() {
            adminModal.style.display = 'none';
        }

        function checkAdminPassword() {
            if (adminPasswordInput.value === ADMIN_PASSWORD) {
                isAdminLoggedIn = true;
                adminPasswordMessage.textContent = 'ƒêƒÉng nh·∫≠p Admin th√†nh c√¥ng!';
                adminPasswordMessage.className = 'modal-message success';
                adminPasswordMessage.style.display = 'block';
                setTimeout(() => {
                    adminPasswordSection.style.display = 'none';
                    adminControlsSection.style.display = 'flex';
                    adminModal.querySelector('h2').textContent = 'Admin Controls';
                    populateUserSelect();
                    displaySelectedUserInfo();
                    // Load background colors if saved
                    const customBg1 = localStorage.getItem('customBgColor1');
                    const customBg2 = localStorage.getItem('customBgColor2');
                    if (customBg1) backgroundColorPicker.value = customBg1;
                    if (customBg2) backgroundColorPicker2.value = customBg2;
                }, 1000);
            } else {
                adminPasswordMessage.textContent = 'M·∫≠t kh·∫©u sai. Vui l√≤ng th·ª≠ l·∫°i.';
                adminPasswordMessage.className = 'modal-message error';
                adminPasswordMessage.style.display = 'block';
            }
        }

        function populateUserSelect() {
            selectUserToEdit.innerHTML = ''; // Clear previous options
            for (const userKey in users) {
                const option = document.createElement('option');
                option.value = userKey;
                option.textContent = users[userKey].username; // Display current username
                selectUserToEdit.appendChild(option);
            }
        }

        function displaySelectedUserInfo() {
            const selectedUserKey = selectUserToEdit.value;
            if (selectedUserKey && users[selectedUserKey]) {
                const user = users[selectedUserKey];
                newLoveChainValueInput.value = user.loveChain;
                editUserNameInput.value = user.username; // Show current username
                editUserGenderSelect.value = user.gender; // Show current gender
            }
        }

        function setLoveChain() {
            const selectedUserKey = selectUserToEdit.value;
            const newValue = parseInt(newLoveChainValueInput.value);
            if (selectedUserKey && users[selectedUserKey] && !isNaN(newValue) && newValue >= 1) {
                users[selectedUserKey].loveChain = newValue;
                users[selectedUserKey].lastClickedDate = getTodayDate(); // Assume it was clicked today for continuity
                users[selectedUserKey].hasClickedToday = true; // Mark as clicked
                saveUsersData();
                updateDashboard();
                showAdminMessage('C·∫≠p nh·∫≠t chu·ªói y√™u th∆∞∆°ng th√†nh c√¥ng!', 'success');
            } else {
                showAdminMessage('Gi√° tr·ªã chu·ªói kh√¥ng h·ª£p l·ªá.', 'error');
            }
        }

        function increaseLoveChain() {
            const selectedUserKey = selectUserToEdit.value;
            if (selectedUserKey && users[selectedUserKey]) {
                users[selectedUserKey].loveChain++;
                newLoveChainValueInput.value = users[selectedUserKey].loveChain; // Update input
                users[selectedUserKey].lastClickedDate = getTodayDate();
                users[selectedUserKey].hasClickedToday = true;
                saveUsersData();
                updateDashboard();
                showAdminMessage('TƒÉng chu·ªói y√™u th∆∞∆°ng th√†nh c√¥ng!', 'success');
            }
        }

        function decreaseLoveChain() {
            const selectedUserKey = selectUserToEdit.value;
            if (selectedUserKey && users[selectedUserKey] && users[selectedUserKey].loveChain > 1) {
                users[selectedUserKey].loveChain--;
                newLoveChainValueInput.value = users[selectedUserKey].loveChain; // Update input
                users[selectedUserKey].lastClickedDate = getTodayDate();
                users[selectedUserKey].hasClickedToday = true;
                saveUsersData();
                updateDashboard();
                showAdminMessage('Gi·∫£m chu·ªói y√™u th∆∞∆°ng th√†nh c√¥ng!', 'success');
            } else {
                showAdminMessage('Kh√¥ng th·ªÉ gi·∫£m chu·ªói d∆∞·ªõi 1.', 'error');
            }
        }

        function resetLoveChainForUser() {
            const selectedUserKey = selectUserToEdit.value;
            if (selectedUserKey && users[selectedUserKey]) {
                users[selectedUserKey].loveChain = 1;
                newLoveChainValueInput.value = 1; // Update input
                users[selectedUserKey].lastClickedDate = ''; // Reset last clicked date
                users[selectedUserKey].hasClickedToday = false;
                saveUsersData();
                updateDashboard();
                showAdminMessage('Reset chu·ªói y√™u th∆∞∆°ng th√†nh c√¥ng!', 'success');
            }
        }

        function editUserName() {
            const selectedUserKey = selectUserToEdit.value;
            const newName = editUserNameInput.value.trim();
            if (selectedUserKey && users[selectedUserKey] && newName !== '') {
                users[selectedUserKey].username = newName;
                saveUsersData();
                populateUserSelect(); // Re-populate dropdown to show new name
                updateNames(); // Update names on dashboard
                showAdminMessage('C·∫≠p nh·∫≠t t√™n t√†i kho·∫£n th√†nh c√¥ng!', 'success');
            } else {
                showAdminMessage('T√™n kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.', 'error');
            }
        }

        function editUserGender() {
            const selectedUserKey = selectUserToEdit.value;
            const newGender = editUserGenderSelect.value;
            if (selectedUserKey && users[selectedUserKey]) {
                users[selectedUserKey].gender = newGender;
                saveUsersData();
                showAdminMessage('C·∫≠p nh·∫≠t gi·ªõi t√≠nh th√†nh c√¥ng!', 'success');
            }
        }

        function showAdminMessage(message, type) {
            adminActionMessage.textContent = message;
            adminActionMessage.className = `modal-message ${type}`;
            adminActionMessage.style.display = 'block';
            setTimeout(() => {
                adminActionMessage.style.display = 'none';
            }, 3000);
        }

        // --- Debug Mode Logic ---
        function toggleDebugMode() {
            isDebugMode = !isDebugMode;
            localStorage.setItem('isDebugMode', isDebugMode); // L∆∞u tr·∫°ng th√°i
            debugToggleButton.classList.toggle('active', isDebugMode);
            debugToggleButton.querySelector('.debug-button-text').textContent = isDebugMode ? 'ƒêANG B·∫¨T' : 'Test';
            if (isDebugMode) {
                // Khi b·∫≠t debug, l∆∞u l·∫°i d·ªØ li·ªáu "th·∫≠t" v√† reset hasClickedToday
                realLoveChainData = JSON.parse(JSON.stringify(users)); // Deep copy
                for (const userKey in users) {
                    users[userKey].hasClickedToday = false; // Lu√¥n cho ph√©p click
                }
                saveUsersData(); // L∆∞u tr·∫°ng th√°i debug v√†o localStorage
                updateDashboard(); // C·∫≠p nh·∫≠t giao di·ªán
                showLoveNotification('Ch·∫ø ƒë·ªô Debug ƒë√£ B·∫¨T. Gi·ªù b·∫°n c√≥ th·ªÉ click tim nhi·ªÅu l·∫ßn!', 'info');
            } else {
                // Khi t·∫Øt debug, kh√¥i ph·ª•c d·ªØ li·ªáu "th·∫≠t" v√† c·∫≠p nh·∫≠t hasClickedToday
                if (realLoveChainData) {
                    users = realLoveChainData;
                    // C·∫ßn c·∫≠p nh·∫≠t l·∫°i hasClickedToday d·ª±a tr√™n ng√†y hi·ªán t·∫°i
                    for (const userKey in users) {
                         users[userKey].hasClickedToday = (users[userKey].lastClickedDate === getTodayDate());
                    }
                    saveUsersData(); // L∆∞u d·ªØ li·ªáu "th·∫≠t" tr·ªü l·∫°i
                } else {
                    // N·∫øu kh√¥ng c√≥ realLoveChainData (v√≠ d·ª•, b·∫≠t debug ngay t·ª´ ƒë·∫ßu),
                    // ch·ªâ c·∫ßn c·∫≠p nh·∫≠t hasClickedToday theo ng√†y hi·ªán t·∫°i
                    for (const userKey in users) {
                        users[userKey].hasClickedToday = (users[userKey].lastClickedDate === getTodayDate());
                    }
                    saveUsersData();
                }
                updateDashboard(); // C·∫≠p nh·∫≠t giao di·ªán
                showLoveNotification('Ch·∫ø ƒë·ªô Debug ƒë√£ T·∫ÆT.', 'success');
            }
        }

        // --- Custom Background Color Logic ---
        function applyBackgroundColors() {
            const color1 = backgroundColorPicker.value;
            const color2 = backgroundColorPicker2.value;

            document.body.style.background = `linear-gradient(135deg, ${color1} 0%, ${color2} 100%)`;
            
            localStorage.setItem('customBgColor1', color1);
            localStorage.setItem('customBgColor2', color2);

            themeMessage.textContent = 'M√†u n·ªÅn ƒë√£ ƒë∆∞·ª£c √°p d·ª•ng v√† l∆∞u!';
            themeMessage.className = 'modal-message success';
            themeMessage.style.display = 'block';
            setTimeout(() => {
                themeMessage.style.display = 'none';
            }, 3000);
        }

        // Initialize background color on page load
        function initializeBackgroundColor() {
            const customBg1 = localStorage.getItem('customBgColor1');
            const customBg2 = localStorage.getItem('customBgColor2');
            if (customBg1 && customBg2) {
                document.body.style.background = `linear-gradient(135deg, ${customBg1} 0%, ${customBg2} 100%)`;
            } else {
                // Apply default gradient if no custom colors are saved
                document.body.style.background = 'linear-gradient(135deg, #fce4ec 0%, #ffcdd2 100%)';
            }
        }

        // H√†m ti·ªán √≠ch chuy·ªÉn ƒë·ªïi RGB sang Hex (kh√¥ng s·ª≠ d·ª•ng tr·ª±c ti·∫øp nh∆∞ng c√≥ th·ªÉ h·ªØu √≠ch)
        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }


        // Ch·∫°y khi DOM ƒë√£ load
        document.addEventListener('DOMContentLoaded', () => {
            initializeBackgroundColor(); // Set background color first
            const lastUser = localStorage.getItem('lastLoggedInUser');
            if (lastUser && users[lastUser]) {
                loginUser(lastUser); // T·ª± ƒë·ªông ƒëƒÉng nh·∫≠p l·∫°i ng∆∞·ªùi d√πng cu·ªëi c√πng
            }
            // Kh·ªüi t·∫°o tr·∫°ng th√°i n√∫t debug
            toggleDebugMode(); // G·ªçi m·ªôt l·∫ßn ƒë·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i hi·ªÉn th·ªã c·ªßa n√∫t
            toggleDebugMode(); // G·ªçi l·∫ßn n·ªØa ƒë·ªÉ ƒë∆∞a n√≥ v·ªÅ tr·∫°ng th√°i ch√≠nh x√°c (do toggle)
        });

    </script>
</body>
</html>
